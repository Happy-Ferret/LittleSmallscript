<!DOCTYPE html>
<html>
    <head>
      <title>Little Smallscript</title>
      <script src="packratparser.js"></script>
      <script src="littleparsers.js"></script>
      <script src="blockparser.js"></script>
      <script src="optimization.js"></script>
      <script src="expressionparser.js"></script>
      <script src="statementparser.js"></script>
      <script src="littlesmallscript.js"></script>
      <script src="littlesmallmethods.js"></script>
      <script src="../lib/beautify.js"></script>
      <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
      <style>
        textarea.source {
          width: 90%;
          height: 20em;
        }
        #lss {
          color: #d3d3d3;
        }
        #lss:focus {
          color: #000;
        }
      </style>
    </head>
    <body>
      <div id="container">
        <div>
          <textarea id="lss" class="source">
| Robot Enemy  |
Enemy <- Object subclass.
Enemy method: [:myname |
  this at: '_name' put: myname.
  this
] at: 'init'.
Enemy method: [| ret caught |
  ret <- false.
  caught <- (((Math random) <*> 10) <<> 3).
  caught ifTrue: [ret <- true].
  ret
] at: 'isCaught'.
Robot <- Object subclass.
Robot method: [:myname |
  this at: '_name' put: myname.
  this
] at: 'init'.
Robot method: [| message |
  message <- 'Hello. I am ' <+> ((this at: '_name') <+> '.').
  window alert: message.
  message
] at: 'greet'.
Robot method: [:enemy :block | | mes |
  mes <- (((this at: '_name') <+> ' is chasing') <+> (enemy at: '_name')).
  [enemy isCaught] whileFalse: [window alert: mes].
  block value
] withKeywords: #('chaseEnemy' 'whenCaught').

Robot new_: 'Yendor' 
  ; greet 
  ; chaseEnemy: (Enemy new_: 'Demogorgon') whenCaught: [
    window alert: 'a robot caught his enemy'
  ]
          </textarea>
        </div>
        <div>
          <button id="_compile-btn">compile</button>
          <button id="_eval-btn">compile and eval</button>
        </div>
        <div>
          <textarea id="js" class="source" disabled></textarea>
        </div>
        <div>
          <textarea id="console" class="source" disabled></textarea>
        </div>
      </div>

      <script type="text/javascript">
        (function () {
          var edited = false;
          var compile_writeAt_ = function (txt, jQ) {
            var js = new LittleSmallscript(txt, {prettyprint: true, optimization: true}).toJS();
            jQ.text(js);
            return js;
          };
          $(function () {
            $('#_compile-btn').click(function () {
              return compile_writeAt_($('#lss').val(), $('#js'));
            });
            $('#_eval-btn').click(function () {
              var js, res;
              js = compile_writeAt_($('#lss').val(), $('#js'));
              try {
                res = eval(js);
              } catch (err) {
                res = err;
              }
              $('#console').text(JSON.stringify(res));
            });
          });
      }).call(this);
    </script>
    </body>
</html>
